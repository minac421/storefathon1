(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8563],{3508:(e,t,a)=>{Promise.resolve().then(a.bind(a,4665))},4399:(e,t,a)=>{"use strict";a.d(t,{P:()=>s,o:()=>r});var s=function(e){return e.GUIDE="guide",e.NEWS="news",e.TIPS="tips",e.ANALYSIS="analysis",e.MARKET="market",e.MEMES="memes",e.EXPERIENCE="experience",e}({}),r=function(e){return e.SWORD="sword",e.FIRE="fire",e.SHIELD="shield",e.CROWN="crown",e.CASTLE="castle",e.LAUGH="laugh",e}({})},4665:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),r=a(2115),l=a(6874),i=a.n(l),n=a(5695),c=a(4399);let d={[c.P.GUIDE]:"دليل اللاعبين",[c.P.NEWS]:"أخبار اللعبة",[c.P.TIPS]:"نصائح وحيل",[c.P.ANALYSIS]:"تحليلات وتقييمات",[c.P.MARKET]:"أخبار السوق"};function o(){(0,n.useRouter)();let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)({total:0,page:1,limit:10,totalPages:0}),[c,o]=(0,r.useState)(!0),[x,m]=(0,r.useState)(null),[h,u]=(0,r.useState)(!1),[g,p]=(0,r.useState)(null),[b,y]=(0,r.useState)(!1),[f,N]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{o(!0);let e="/api/blog?page=".concat(a.page,"&limit=").concat(a.limit,"&includeUnpublished=true"),s=await fetch(e);if(!s.ok)throw Error("خطأ في الاتصال: ".concat(s.status));let r=await s.json();t(r.posts),l(r.pagination)}catch(e){console.error("خطأ في تحميل المقالات:",e),m("حدث خطأ أثناء تحميل المقالات. يرجى المحاولة مرة أخرى.")}finally{o(!1)}})()},[a.page,a.limit]);let w=e=>{e>0&&e<=a.totalPages&&l(t=>({...t,page:e}))},j=e=>{let t=new Date(e);return new Intl.DateTimeFormat("ar-EG",{year:"numeric",month:"long",day:"numeric"}).format(t)},v=e=>{p(e),u(!0)},P=async()=>{if(g)try{let a=await fetch("/api/blog?id=".concat(g),{method:"DELETE"});if(!a.ok)throw Error("خطأ في الاتصال: ".concat(a.status));t(e.filter(e=>e.id!==g)),u(!1),p(null),N("تم حذف المقال بنجاح"),setTimeout(()=>N(null),3e3)}catch(e){console.error("خطأ في حذف المقال:",e),m("حدث خطأ أثناء حذف المقال. يرجى المحاولة مرة أخرى."),setTimeout(()=>m(null),3e3)}},E=async a=>{console.log("بدء الموافقة على المقال:",a),y(!0),p(a);try{let s={id:a,isPublished:!0,isApproved:!0};console.log("إرسال طلب PUT إلى /api/blog:",JSON.stringify(s,null,2));let r=await fetch("/api/blog",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),l=await r.json().catch(()=>({}));if(console.log("استجابة الخادم:",{status:r.status,data:l}),!r.ok)throw Error(l.error||"خطأ في الاتصال: ".concat(r.status));t(e.map(e=>e._id===a?{...e,isPublished:!0,isApproved:!0}:e)),N("تمت الموافقة على المقال ونشره بنجاح"),setTimeout(()=>N(null),3e3)}catch(t){console.error("خطأ في الموافقة على المقال:",t);let e=t instanceof Error?t.message:"حدث خطأ غير معروف";m("حدث خطأ أثناء الموافقة على المقال: ".concat(e)),setTimeout(()=>m(null),3e3)}finally{y(!1),p(null)}};return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"إدارة المدونة"}),(0,s.jsxs)(i(),{href:"/admin/blog/new",className:"bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})}),"مقال جديد"]})]}),x&&(0,s.jsx)("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg mb-6",children:x}),f&&(0,s.jsx)("div",{className:"bg-green-100 text-green-700 p-4 rounded-lg mb-6",children:f}),c?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-amber-600 border-t-transparent rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"جاري تحميل المقالات..."})]}):0===e.length?(0,s.jsxs)("div",{className:"text-center bg-gray-50 p-8 rounded-lg",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-700 mb-2",children:"لا توجد مقالات"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"أضف مقالات جديدة لتظهر هنا"}),(0,s.jsx)(i(),{href:"/admin/blog/new",className:"bg-amber-600 hover:bg-amber-700 text-white px-6 py-2 rounded-lg inline-block",children:"إضافة مقال جديد"})]}):(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-6",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"العنوان"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الفئة"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الكاتب"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المشاهدات"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ النشر"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الإجراءات"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map((e,t)=>{var a;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.slug})]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800",children:d[e.category]||e.category})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:e.author?"string"==typeof e.author?e.author:(null==(a=e.author)?void 0:a.name)||"مستخدم":"غير معروف"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.views}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:j(e.createdAt)})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.isPublished?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isPublished?"منشور":"مسودة"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-left text-sm font-medium",children:(0,s.jsxs)("div",{className:"flex space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(i(),{href:"/blog/".concat(e.slug),className:"text-blue-600 hover:text-blue-900",target:"_blank",children:"عرض"}),(0,s.jsx)(i(),{href:"/admin/blog/new?edit=true&id=".concat(e._id),className:"text-amber-600 hover:text-amber-900",children:"تعديل"}),!e.isPublished&&(0,s.jsx)("button",{onClick:()=>E(e._id||""),className:"text-green-600 hover:text-green-900",disabled:b&&g===e._id,children:b&&g===e._id?"جاري...":"نشر"}),(0,s.jsx)("button",{onClick:()=>v(e._id||""),className:"text-red-600 hover:text-red-900",disabled:h&&g===e._id,children:h&&g===e._id?"جاري...":"حذف"})]})})]},"post-".concat(e.id,"-").concat(t))})})]})}),!c&&a.totalPages>1&&(0,s.jsx)("div",{className:"flex justify-center mt-4",children:(0,s.jsxs)("nav",{className:"inline-flex rounded-md shadow-sm -space-x-px rtl:space-x-reverse","aria-label":"Pagination",children:[(0,s.jsx)("button",{onClick:()=>w(a.page-1),disabled:1===a.page,className:"relative inline-flex items-center px-4 py-2 rounded-r-md border ".concat(1===a.page?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-amber-50"," text-sm font-medium"),children:"السابق"}),Array.from({length:a.totalPages}).map((e,t)=>{let r=t+1;return(0,s.jsx)("button",{onClick:()=>w(r),className:"relative inline-flex items-center px-4 py-2 border ".concat(a.page===r?"bg-amber-600 text-white font-bold":"bg-white text-gray-700 hover:bg-amber-50"," text-sm"),children:r},r)}),(0,s.jsx)("button",{onClick:()=>w(a.page+1),disabled:a.page===a.totalPages,className:"relative inline-flex items-center px-4 py-2 rounded-l-md border ".concat(a.page===a.totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-amber-50"," text-sm font-medium"),children:"التالي"})]})}),h&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"تأكيد الحذف"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"هل أنت متأكد من رغبتك في حذف هذا المقال؟ لا يمكن التراجع عن هذه العملية."}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)("button",{onClick:()=>{p(null),u(!1)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"إلغاء"}),(0,s.jsx)("button",{onClick:P,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"حذف"})]})]})})]})}},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[6874,8441,1684,7358],()=>t(3508)),_N_E=e.O()}]);