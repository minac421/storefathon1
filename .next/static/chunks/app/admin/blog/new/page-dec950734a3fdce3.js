(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5174],{3571:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var a=t(5155),s=t(2115),l=t(5695),n=t(6874),o=t.n(n),d=t(4399);let i=e=>{let{value:r,onChange:t}=e,l=(0,s.useRef)(null),n=e=>{let r=window.getSelection();if(!r||0===r.rangeCount)return;let a=r.getRangeAt(0),s=a.toString();if(!s)return;let n=document.createElement(e);n.textContent=s,a.deleteContents(),a.insertNode(n),l.current&&t(l.current.innerHTML)};return(0,a.jsxs)("div",{className:"border border-gray-300 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-100 p-2 flex gap-2 border-b border-gray-300",children:[(0,a.jsx)("button",{type:"button",onClick:()=>n("h2"),className:"px-2 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50",title:"عنوان رئيسي",children:"H2"}),(0,a.jsx)("button",{type:"button",onClick:()=>n("h3"),className:"px-2 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50",title:"عنوان فرعي",children:"H3"}),(0,a.jsx)("button",{type:"button",onClick:()=>n("p"),className:"px-2 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50",title:"فقرة",children:"P"}),(0,a.jsx)("button",{type:"button",onClick:()=>n("strong"),className:"px-2 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 font-bold",title:"غامق",children:"B"}),(0,a.jsx)("button",{type:"button",onClick:()=>n("em"),className:"px-2 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 italic",title:"مائل",children:"I"}),(0,a.jsx)("button",{type:"button",onClick:()=>n("u"),className:"px-2 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 underline",title:"تحته خط",children:"U"})]}),(0,a.jsx)("div",{ref:l,contentEditable:!0,dangerouslySetInnerHTML:{__html:r},onInput:e=>t(e.currentTarget.innerHTML),className:"p-4 min-h-[300px] focus:outline-none",dir:"rtl"})]})};function c(){let e=(0,l.useRouter)(),r=(0,l.useSearchParams)(),t="true"===r.get("edit"),n=r.get("id"),[c,u]=(0,s.useState)({title:"",summary:"",content:"",category:d.P.NEWS,featuredImage:"",author:"فريق الفاتحون",tags:"",isPublished:!1}),[m,h]=(0,s.useState)(t),[g,b]=(0,s.useState)(!1),[x,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{if(t&&n)try{h(!0);let t=await fetch("/api/blog?id=".concat(n));if(!t.ok){if(404===t.status)return void e.push("/admin/blog");throw Error("خطأ في الاتصال: ".concat(t.status))}let a=await t.json();if(a.post){var r;let e=a.post;u({title:e.title||"",summary:e.summary||"",content:e.content||"",category:e.category||d.P.NEWS,featuredImage:e.featuredImage||"",author:e.author||"",tags:(null==(r=e.tags)?void 0:r.join(", "))||"",isPublished:void 0===e.isPublished||e.isPublished})}else e.push("/admin/blog")}catch(e){console.error("خطأ في تحميل المقال:",e),p("حدث خطأ أثناء تحميل المقال. يرجى المحاولة مرة أخرى.")}finally{h(!1)}})()},[n,t,e]);let y=e=>{let{name:r,value:t,type:a}=e.target;if("checkbox"===a){let{checked:t}=e.target;u(e=>({...e,[r]:t}))}else u(e=>({...e,[r]:t}))},f=async r=>{r.preventDefault();try{b(!0),p(null);let r=c.tags.split(",").map(e=>e.trim()).filter(e=>""!==e),a={...c,tags:r};t&&n&&(a.id=n);let s=await fetch("/api/blog",{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw Error("خطأ في الاتصال: ".concat(s.status));let l=await s.json();if(l.success)e.push("/admin/blog");else throw Error(l.error||"حدث خطأ أثناء حفظ المقال")}catch(e){console.error("خطأ في إنشاء المقال:",e),p(e instanceof Error?e.message:"حدث خطأ أثناء حفظ المقال. يرجى المحاولة مرة أخرى.")}finally{b(!1)}};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:t?"تعديل المقال":"مقال جديد"}),(0,a.jsxs)(o(),{href:"/admin/blog",className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-1 transform rotate-180",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})}),"العودة"]})]}),x&&(0,a.jsx)("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg mb-6",children:x}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-6",children:(0,a.jsxs)("form",{onSubmit:f,className:"p-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsxs)("label",{htmlFor:"title",className:"block text-gray-700 font-medium mb-2",children:["عنوان المقال ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",id:"title",name:"title",value:c.title,onChange:y,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"أدخل عنوان المقال"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsxs)("label",{htmlFor:"summary",className:"block text-gray-700 font-medium mb-2",children:["ملخص المقال ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("textarea",{id:"summary",name:"summary",value:c.summary,onChange:y,required:!0,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"اكتب ملخصًا قصيرًا للمقال (لا يزيد عن 300 حرف)",maxLength:300})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"category",className:"block text-gray-700 font-medium mb-2",children:["الفئة ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("select",{id:"category",name:"category",value:c.category,onChange:y,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500",children:Object.entries(d.P).map(e=>{let[r,t]=e;return(0,a.jsxs)("option",{value:t,children:[t===d.P.GUIDE&&"دليل اللاعبين",t===d.P.NEWS&&"أخبار اللعبة",t===d.P.TIPS&&"نصائح وحيل",t===d.P.ANALYSIS&&"تحليلات وتقييمات",t===d.P.MARKET&&"أخبار السوق"]},r)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"author",className:"block text-gray-700 font-medium mb-2",children:"الكاتب"}),(0,a.jsx)("input",{type:"text",id:"author",name:"author",value:c.author,onChange:y,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"اسم الكاتب"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsxs)("label",{htmlFor:"featuredImage",className:"block text-gray-700 font-medium mb-2",children:["رابط الصورة المصغرة ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"url",id:"featuredImage",name:"featuredImage",value:c.featuredImage,onChange:y,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"أدخل رابط الصورة (مثال: https://example.com/image.jpg)"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"tags",className:"block text-gray-700 font-medium mb-2",children:"الوسوم (مفصولة بفواصل)"}),(0,a.jsx)("input",{type:"text",id:"tags",name:"tags",value:c.tags,onChange:y,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"مثال: قلاع, هيبة, أبطال"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"أدخل الوسوم مفصولة بفواصل"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"isPublished",name:"isPublished",checked:c.isPublished,onChange:y,className:"h-5 w-5 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"isPublished",className:"mr-2 block text-gray-700",children:"نشر المقال"})]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"إذا لم يتم تحديد هذا الخيار، سيتم حفظ المقال كمسودة ولن يظهر للزوار"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsxs)("label",{htmlFor:"content",className:"block text-gray-700 font-medium mb-2",children:["محتوى المقال ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(i,{value:c.content,onChange:e=>{u(r=>({...r,content:e}))}})]})]}),(0,a.jsxs)("div",{className:"mt-8 flex justify-end space-x-4 rtl:space-x-reverse",children:[(0,a.jsx)(o(),{href:"/admin/blog",className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"إلغاء"}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"px-6 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 ".concat(g?"opacity-70 cursor-not-allowed":""),children:g?"جاري الحفظ...":t?"حفظ التغييرات":"حفظ المقال"})]})]})})]})}},4399:(e,r,t)=>{"use strict";t.d(r,{P:()=>a,o:()=>s});var a=function(e){return e.GUIDE="guide",e.NEWS="news",e.TIPS="tips",e.ANALYSIS="analysis",e.MARKET="market",e.MEMES="memes",e.EXPERIENCE="experience",e}({}),s=function(e){return e.SWORD="sword",e.FIRE="fire",e.SHIELD="shield",e.CROWN="crown",e.CASTLE="castle",e.LAUGH="laugh",e}({})},5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},9920:(e,r,t)=>{Promise.resolve().then(t.bind(t,3571))}},e=>{var r=r=>e(e.s=r);e.O(0,[6874,8441,1684,7358],()=>r(9920)),_N_E=e.O()}]);