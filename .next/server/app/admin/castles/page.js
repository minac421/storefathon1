(()=>{var e={};e.id=4264,e.ids=[4264],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26392:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>c});var t=s(60687),a=s(43210),l=s.n(a),n=s(85814),i=s.n(n),o=s(16189);let d=[{id:"castle-1",name:"قلعة الصمود",description:"قلعة مستوى 10 قوية مع تحصينات متقدمة.",level:10,strength:75,price:500,features:["تحصينات متقدمة","خندق دفاعي","أبراج مراقبة"],icon:"\uD83C\uDFF0",popular:!0,videoUrl:"https://example.com/castle1.mp4"},{id:"castle-2",name:"قلعة الفاتح",description:"قلعة مستوى 15 مع مرافق هجومية ودفاعية متوازنة.",level:15,strength:90,price:900,features:["دفاعات متطورة","قاعة تدريب فاخرة","سجن القلعة"],icon:"\uD83C\uDFEF",popular:!1,videoUrl:"https://example.com/castle2.mp4"}];function c(){(0,o.useRouter)();let[e,r]=(0,a.useState)(d),[s,l]=(0,a.useState)(!1),[n,c]=(0,a.useState)(!1),[p,u]=(0,a.useState)(null),m=async s=>{if(confirm("هل أنت متأكد من حذف هذه القلعة؟"))try{l(!0);let t=await fetch(`/api/castles?id=${s}`,{method:"DELETE"});if(!t.ok)throw Error(`خطأ في حذف القلعة: ${t.status}`);r(e.filter(e=>e.id!==s)),l(!1)}catch(e){console.error("خطأ في حذف القلعة:",e),l(!1),alert("حدث خطأ أثناء حذف القلعة")}},h=e=>{u(e),c(!0)},g=async s=>{l(!0);try{if(s.id&&"castle-1"!==s.id&&"castle-2"!==s.id){let t=await fetch("/api/castles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw Error(`خطأ في تحديث القلعة: ${t.status}`);r(e.map(e=>e.id===s.id?s:e))}else{let t={...s};("castle-1"===t.id||"castle-2"===t.id)&&delete t.id;let a=await fetch("/api/castles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error(`خطأ في إضافة القلعة: ${a.status}`);let l=await a.json();r([...e,{...s,id:l.id}])}c(!1),u(null)}catch(e){console.error("خطأ في حفظ القلعة:",e),alert("حدث خطأ أثناء حفظ القلعة")}finally{l(!1)}};return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 bg-gray-50 min-h-screen rtl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"إدارة القلاع"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(i(),{href:"/admin",className:"bg-gray-200 px-4 py-2 rounded hover:bg-gray-300",children:"العودة للوحة التحكم"}),(0,t.jsx)("button",{onClick:()=>{u(null),c(!0)},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"إضافة قلعة جديدة"})]})]}),s?(0,t.jsx)("div",{className:"text-center py-8",children:"جاري تحميل البيانات..."}):n?(0,t.jsx)(x,{castle:p,onCancel:()=>c(!1),onSave:g}):(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"القلعة"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستوى"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"القوة"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"السعر"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"فيديو"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراءات"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"text-2xl mr-2",children:e.icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,t.jsx)("div",{className:"text-gray-500 text-sm truncate max-w-xs",children:e.description})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.level}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.strength}),(0,t.jsxs)("td",{className:"px-6 py-4",children:[e.price," $"]}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.videoUrl?(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"متوفر"}):(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"غير متوفر"})}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>h(e),className:"text-blue-600 hover:text-blue-900 ml-2",children:"تحرير"}),(0,t.jsx)("button",{onClick:()=>e.id&&m(e.id),className:"text-red-600 hover:text-red-900",children:"حذف"})]})})]},e.id))})]})})]})}function x({castle:e,onCancel:r,onSave:s}){let n=!!e,[i,o]=(0,a.useState)(e||{id:"",name:"",description:"",level:1,strength:50,price:100,features:[],icon:"\uD83C\uDFF0",popular:!1,videoUrl:""}),[d,c]=(0,a.useState)(""),[x,p]=(0,a.useState)({file:null,uploading:!1,progress:0,error:null,url:i.videoUrl||null}),u=l().useRef(null),m=e=>{if(!e)return 0;let r=e.toString().trim().toUpperCase();return r.endsWith("K")?1e3*parseFloat(r.replace("K","")):r.endsWith("M")?1e6*parseFloat(r.replace("M","")):r.endsWith("B")?1e9*parseFloat(r.replace("B","")):parseFloat(r)||0},h=e=>e>=1e9?(e/1e9).toFixed(1)+"B":e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),g=e=>{let{name:r,value:s,type:t}=e.target;if("checkbox"===t){let s=e.target.checked;o({...i,[r]:s})}else"level"===r?o({...i,[r]:parseInt(s)||0}):"strength"===r||"price"===r?o({...i,[r]:m(s)}):o({...i,[r]:s})},b=e=>{let r=[...i.features||[]];r.splice(e,1),o({...i,features:r})},v=async()=>{if(!x.file)return void p(e=>({...e,error:"يجب تحديد فيديو للرفع"}));if(!i.id)try{let e=new FileReader;e.readAsDataURL(x.file),e.onload=()=>{let r=e.result;p({file:x.file,uploading:!1,progress:100,error:null,url:r}),o(e=>({...e,videoUrl:r}))},e.onerror=()=>{throw Error("حدث خطأ أثناء قراءة الفيديو")},p(e=>({...e,uploading:!0,progress:5,error:null}));let r=10,s=setInterval(()=>{r+=10,p(e=>({...e,progress:r})),r>=90&&clearInterval(s)},200);return}catch(e){console.error("خطأ في معالجة الفيديو:",e),p(e=>({...e,error:"حدث خطأ أثناء معالجة الفيديو"}));return}p(e=>({...e,uploading:!0,progress:5,error:null}));try{let e=new FormData;e.append("castleId",i.id),e.append("video",x.file),e.append("videoTitle",i.name);let r=setInterval(()=>{p(e=>e.progress<90?{...e,progress:e.progress+10}:e)},500),s=await fetch("/api/castles/upload-video",{method:"POST",body:e});if(clearInterval(r),!s.ok){let e=await s.text();throw Error(e||"فشل في رفع الفيديو")}let t=await s.json();p({file:x.file,uploading:!1,progress:100,error:null,url:t.videoData.url}),o(e=>({...e,videoUrl:t.videoData.url}))}catch(e){console.error("Error al cargar el v\xeddeo:",e),p(r=>({...r,uploading:!1,error:e instanceof Error?e.message:"حدث خطأ أثناء رفع الفيديو"}))}};return(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-6",children:n?"تعديل قلعة":"إضافة قلعة جديدة"}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=i.videoUrl;x.url&&(r=x.url),r&&console.log("حفظ رابط الفيديو:",r=r.trim());let t={...i,features:i.features||[],videoUrl:r};console.log("بيانات القلعة المحدثة:",t),s(t)},children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"اسم القلعة *"}),(0,t.jsx)("input",{type:"text",name:"name",value:i.name||"",onChange:g,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"الرمز التعبيري"}),(0,t.jsxs)("select",{name:"icon",value:i.icon||"\uD83C\uDFF0",onChange:g,className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,t.jsx)("option",{value:"\uD83C\uDFF0",children:"\uD83C\uDFF0 قلعة"}),(0,t.jsx)("option",{value:"\uD83C\uDFEF",children:"\uD83C\uDFEF قلعة يابانية"}),(0,t.jsx)("option",{value:"\uD83C\uDFDB️",children:"\uD83C\uDFDB️ مبنى كلاسيكي"}),(0,t.jsx)("option",{value:"\uD83C\uDFD8️",children:"\uD83C\uDFD8️ منازل"}),(0,t.jsx)("option",{value:"⚔️",children:"⚔️ سيوف"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"وصف القلعة *"}),(0,t.jsx)("textarea",{name:"description",value:i.description||"",onChange:g,className:"w-full p-2 border border-gray-300 rounded-md",rows:3,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"المستوى"}),(0,t.jsx)("input",{type:"number",name:"level",min:"1",value:i.level||1,onChange:g,className:"w-full p-2 border border-gray-300 rounded-md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"القوة"}),(0,t.jsx)("input",{type:"text",name:"strength",value:i.strength?h(i.strength):"50",onChange:g,className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"مثال: 1M, 500K, 2B"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"السعر"}),(0,t.jsx)("input",{type:"text",name:"price",value:i.price?h(i.price):"100",onChange:g,className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"مثال: 1M, 500K, 2B"})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{className:"inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",name:"popular",checked:i.popular||!1,onChange:g,className:"form-checkbox h-5 w-5 text-blue-600"}),(0,t.jsx)("span",{className:"mr-2 text-gray-700",children:"مميز (عرض شارة مميز)"})]})}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"ميزات القلعة"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),className:"flex-grow p-2 border border-gray-300 rounded-r-none rounded-md",placeholder:"أضف ميزة جديدة"}),(0,t.jsx)("button",{type:"button",onClick:()=>{d.trim()&&(o({...i,features:[...i.features||[],d.trim()]}),c(""))},className:"bg-blue-600 text-white px-4 py-2 rounded-l-none rounded-md hover:bg-blue-700",children:"إضافة"})]}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:i.features?.map((e,r)=>(0,t.jsxs)("div",{className:"bg-gray-100 px-3 py-1 rounded-full flex items-center",children:[(0,t.jsx)("span",{children:e}),(0,t.jsx)("button",{type:"button",onClick:()=>b(r),className:"ml-2 text-gray-500 hover:text-gray-700",children:"\xd7"})]},r))})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"رابط فيديو القلعة"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("input",{type:"text",name:"videoUrl",value:i.videoUrl||"",onChange:g,className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"أدخل رابط فيديو YouTube أو رابط مباشر للفيديو"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"يمكنك إضافة رابط مباشر لملف فيديو أو رابط فيديو YouTube"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-gray-700 mb-2",children:"رفع فيديو"}),(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 p-6 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>u.current?.click(),children:[(0,t.jsx)("div",{className:"text-center",children:x.file?(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,t.jsx)("span",{className:"mt-2 text-gray-700",children:x.file.name}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[(x.file.size/1048576).toFixed(2)," ميجابايت"]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,t.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,t.jsx)("div",{className:"flex justify-center text-sm text-gray-600 mt-2",children:(0,t.jsx)("label",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none",children:(0,t.jsx)("span",{children:"رفع ملف فيديو"})})}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"MP4, WebM, AVI بحد أقصى 50 ميجابايت"})]})}),(0,t.jsx)("input",{ref:u,type:"file",className:"sr-only",accept:"video/mp4,video/webm,video/avi,video/quicktime",onChange:e=>{let r=e.target.files;if(r&&r.length>0){let e=r[0];if(e.size>0x3200000)return void p(e=>({...e,error:"حجم الفيديو أكبر من الحد المسموح به (50 ميجابايت)",file:null}));p(r=>({...r,file:e,error:null,progress:0,uploading:!1}))}}})]}),x.file&&!x.uploading&&!x.url&&(0,t.jsx)("button",{type:"button",onClick:v,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"رفع الفيديو"}),x.uploading&&(0,t.jsxs)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:[(0,t.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${x.progress}%`}}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["جاري الرفع... ",x.progress,"%"]})]}),x.error&&(0,t.jsx)("p",{className:"text-red-500",children:x.error}),x.url&&(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,t.jsx)("p",{className:"text-green-600 font-semibold mb-2",children:"تم رفع الفيديو بنجاح!"}),(0,t.jsxs)("video",{className:"w-full mt-2 rounded-lg",controls:!0,children:[(0,t.jsx)("source",{src:x.url,type:"video/mp4"}),"المتصفح لا يدعم تشغيل الفيديو."]})]})]})]})]}),(0,t.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"ml-3 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"إلغاء"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:n?"حفظ التغييرات":"إنشاء قلعة"})]})]})]})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},35806:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>t});let t=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\minaa\\\\CascadeProjects\\\\conquerors-website\\\\src\\\\app\\\\admin\\\\castles\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\admin\\castles\\page.tsx","default")},42332:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>n.a,__next_app__:()=>x,pages:()=>c,routeModule:()=>p,tree:()=>d});var t=s(65239),a=s(48088),l=s(88170),n=s.n(l),i=s(30893),o={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(r,o);let d={children:["",{children:["admin",{children:["castles",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,35806)),"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\admin\\castles\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,94431)),"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,54431)),"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,54413)),"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\admin\\castles\\page.tsx"],x={require:s,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/admin/castles/page",pathname:"/admin/castles",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},59834:(e,r,s)=>{Promise.resolve().then(s.bind(s,35806))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77762:(e,r,s)=>{Promise.resolve().then(s.bind(s,26392))}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[7719,4738,7583],()=>s(42332));module.exports=t})();