(()=>{var e={};e.id=7242,e.ids=[7242],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,t,r)=>{"use strict";r.d(t,{kR:()=>u});var n=r(56037),s=r.n(n);let i=process.env.MONGODB_URI||"mongodb://localhost:27017/conquerors-website";i||console.warn("تحذير: تأكد من تعيين متغير البيئة MONGODB_URI في ملف .env أو .env.local");let a={isConnected:!1},o=async()=>{if(a.isConnected)return void console.log("\uD83C\uDF10 استخدام اتصال موجود بقاعدة البيانات");try{let e=await s().connect(i);a.isConnected=1===e.connections[0].readyState,console.log("✅ تم الاتصال بقاعدة البيانات MongoDB بنجاح")}catch(e){throw console.error("❌ خطأ في الاتصال بقاعدة البيانات:",e),Error("فشل الاتصال بقاعدة البيانات")}},u=async e=>(await o(),await e())},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},17278:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(56037),s=r.n(n),i=r(99493);let a=new(s()).Schema({author:{userId:{type:String,default:null},name:{type:String,required:[!0,"الرجاء إدخال اسم المعلق"]},avatar:{type:String,default:null}},content:{type:String,required:[!0,"الرجاء إدخال نص التعليق"],trim:!0,maxlength:[500,"يجب ألا يزيد التعليق عن 500 حرف"]},likes:[{type:String}],replies:[{author:{userId:{type:String,default:null},name:{type:String,required:!0},avatar:{type:String,default:null}},content:{type:String,required:!0,trim:!0,maxlength:[300,"يجب ألا يزيد الرد عن 300 حرف"]},likes:[{type:String}],createdAt:{type:Date,default:Date.now}}],isApproved:{type:Boolean,default:!0},createdAt:{type:Date,default:Date.now}},{timestamps:!0}),o=new(s()).Schema({userId:{type:String,default:null},name:{type:String,required:!0},avatar:{type:String,default:null},bio:{type:String,default:""},contactInfo:{type:String,default:null},isFeatured:{type:Boolean,default:!1},isVerified:{type:Boolean,default:!1}}),u=new(s()).Schema({title:{type:String,required:[!0,"الرجاء إدخال عنوان المقال"],trim:!0,maxlength:[100,"يجب ألا يزيد العنوان عن 100 حرف"]},slug:{type:String,required:!0,unique:!0,trim:!0},content:{type:String,required:[!0,"الرجاء إدخال محتوى المقال"]},summary:{type:String,required:[!0,"الرجاء إدخال ملخص المقال"],maxlength:[300,"يجب ألا يزيد الملخص عن 300 حرف"]},category:{type:String,required:[!0,"الرجاء اختيار فئة المقال"],enum:Object.values(i.P),default:i.P.NEWS},author:o,featuredImage:{type:String,default:null},media:{images:[{type:String}],videos:[{url:{type:String},thumbnail:{type:String,default:null},title:{type:String,default:""},duration:{type:Number,default:0}}]},interaction:{likes:[{type:String}],shares:{type:Number,default:0},bookmarks:[{type:String}],views:{type:Number,default:0},reactions:{fire:[{type:String}],shield:[{type:String}],crown:[{type:String}],castle:[{type:String}],laugh:[{type:String}]}},comments:[a],tags:[{type:String,trim:!0}],isFeatured:{type:Boolean,default:!1},isPinned:{type:Boolean,default:!1},isPublished:{type:Boolean,default:!0},needsReview:{type:Boolean,default:!0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now},publishedAt:{type:Date,default:null}},{timestamps:!0});u.index({title:"text",content:"text",tags:"text"});let c=s().models.BlogPost||s().model("BlogPost",u)},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74762:(e,t,r)=>{"use strict";async function n(e,t){return await e.findById(t).lean().exec()}async function s(e,t){return await e.findOne(t).lean().exec()}async function i(e,t={},r={}){let{sort:n={createdAt:-1},limit:s=100,skip:a=0}=r;return await e.find(t).sort(n).skip(a).limit(s).lean().exec()}async function a(e,t,r,n={}){return await e.updateOne(t,r,n).exec()}async function o(e,t){return await e.deleteOne(t).exec()}async function u(e,t={}){return await e.countDocuments(t).exec()}r.d(t,{HO:()=>u,Vy:()=>i,Xg:()=>function e(t){if(!t)return t;if(Array.isArray(t))return t.map(t=>e(t));let r={...t};if(r._id){let e="object"==typeof r._id&&r._id.toString?r._id.toString():r._id;r.id||(r.id=e)}return r},fW:()=>s,kd:()=>o,mZ:()=>a,um:()=>n})},78335:()=>{},87994:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>f,serverHooks:()=>S,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{DELETE:()=>y,GET:()=>m,POST:()=>g});var s=r(96559),i=r(48088),a=r(37719),o=r(32190),u=r(5069),c=r(17278),l=r(56037),d=r.n(l),p=r(74762);async function m(e){let t=e.nextUrl.searchParams,r=t.get("postId"),n=t.get("type");if(!r)return o.NextResponse.json({error:"معرف المنشور مطلوب"},{status:400});try{return await (0,u.kR)(async()=>{let e=await (0,p.um)(c.A,r);return e?"likes"===n?o.NextResponse.json({success:!0,likes:e.interaction?.likes||[],count:e.interaction?.likes?.length||0}):"comments"===n?o.NextResponse.json({success:!0,comments:e.comments||[],count:e.comments?.length||0}):o.NextResponse.json({error:'نوع التفاعل غير صالح. يجب أن يكون "likes" أو "comments"'},{status:400}):o.NextResponse.json({error:"المنشور غير موجود"},{status:404})})}catch(e){return console.error("Error fetching interactions:",e),o.NextResponse.json({error:"حدث خطأ أثناء استرجاع التفاعلات"},{status:500})}}async function g(e){try{let t=await e.json(),{action:r,postId:n,userId:s,commentId:i,content:a}=t;if(!n||!s||!r)return o.NextResponse.json({error:"المعلومات غير كاملة"},{status:400});return await (0,u.kR)(async()=>{let e=await (0,p.um)(c.A,n);if(!e)return o.NextResponse.json({error:"المنشور غير موجود"},{status:404});if("like"===r){let t,r=e.interaction.likes||[],i=r.indexOf(s),a=-1===i;return t=a?{$addToSet:{"interaction.likes":s}}:{$pull:{"interaction.likes":s}},await (0,p.mZ)(c.A,{_id:n},t),a?r.push(s):r.splice(i,1),o.NextResponse.json({success:!0,likes:r,userLiked:a,count:r.length})}if("comment"===r&&a){let e={_id:new(d()).Types.ObjectId,author:{userId:s,name:t.displayName||"مستخدم",avatar:t.avatar||"/images/avatars/default.png"},content:a,likes:[],replies:[],isApproved:!0,createdAt:new Date};return await (0,p.mZ)(c.A,{_id:n},{$push:{comments:e}}),o.NextResponse.json({success:!0,comment:e})}if("reply"===r&&a&&i){let r=e.comments.findIndex(e=>e._id&&e._id.toString()===i);if(-1===r)return o.NextResponse.json({error:"التعليق غير موجود"},{status:404});let u={_id:new(d()).Types.ObjectId,author:{userId:s,name:t.displayName||"مستخدم",avatar:t.avatar||"/images/avatars/default.png"},content:a,likes:[],isApproved:!0,createdAt:new Date};return await (0,p.mZ)(c.A,{_id:n,"comments._id":new(d()).Types.ObjectId(i)},{$push:{"comments.$.replies":u}}),o.NextResponse.json({success:!0,reply:u})}if("likeComment"===r&&i){let t,r=e.comments.findIndex(e=>e._id&&e._id.toString()===i);if(-1===r)return o.NextResponse.json({error:"التعليق غير موجود"},{status:404});let a=e.comments[r].likes||[],u=a.indexOf(s),l=-1===u;return t=l?{$addToSet:{[`comments.${r}.likes`]:s}}:{$pull:{[`comments.${r}.likes`]:s}},await (0,p.mZ)(c.A,{_id:n},t),l?a.push(s):a.splice(u,1),o.NextResponse.json({success:!0,likes:a,userLiked:l,count:a.length})}if("share"===r){let t=e.interaction.shares||[],r=t.indexOf(s);return -1===r&&t.push(s),await (0,p.mZ)(c.A,{_id:n},{$set:{"interaction.shares":t}}),o.NextResponse.json({success:!0,shares:t,count:t.length})}if("bookmark"===r){let t=e.interaction.bookmarks||[],r=t.indexOf(s);return -1===r?t.push(s):t.splice(r,1),await (0,p.mZ)(c.A,{_id:n},{$set:{"interaction.bookmarks":t}}),o.NextResponse.json({success:!0,bookmarks:t,isBookmarked:-1===r,count:t.length})}if("react"===r&&t.reactionType){let r=t.reactionType;if(!["sword","fire","shield","crown","castle"].includes(r))return o.NextResponse.json({error:"نوع التفاعل غير صالح"},{status:400});e.interaction.reactions||(e.interaction.reactions={sword:[],fire:[],shield:[],crown:[],castle:[]}),e.interaction.reactions[r]||(e.interaction.reactions[r]=[]);let i=e.interaction.reactions[r],a=i.indexOf(s);-1===a?i.push(s):i.splice(a,1);let u={...e.interaction.reactions,[r]:i};return await (0,p.mZ)(c.A,{_id:n},{$set:{"interaction.reactions":u}}),o.NextResponse.json({success:!0,reactions:u,userReacted:-1===a,type:r})}return o.NextResponse.json({error:"نوع الإجراء غير معتمد"},{status:400})})}catch(e){return console.error("Error handling interaction:",e),o.NextResponse.json({error:"حدث خطأ أثناء معالجة التفاعل"},{status:500})}}async function y(e){try{let t=e.nextUrl.searchParams,r=t.get("postId"),n=t.get("commentId"),s=t.get("replyId"),i=t.get("userId");if(!r||!i||!n)return o.NextResponse.json({error:"معلومات غير كاملة"},{status:400});return await (0,u.kR)(async()=>{let e=await (0,p.um)(c.A,r);if(!e)return o.NextResponse.json({error:"المنشور غير موجود"},{status:404});if(s){let t=e.comments.findIndex(e=>e._id&&e._id.toString()===n);if(-1===t)return o.NextResponse.json({error:"التعليق غير موجود"},{status:404});let r=e.comments[t];if(!r.replies||0===r.replies.length)return o.NextResponse.json({error:"لا توجد ردود لهذا التعليق"},{status:404});let a=r.replies.findIndex(e=>e._id&&e._id.toString()===s);return -1===a?o.NextResponse.json({error:"الرد غير موجود"},{status:404}):r.replies[a].author.userId!==i?o.NextResponse.json({error:"غير مصرح لك بحذف هذا الرد"},{status:403}):(r.replies.splice(a,1),e.comments[t]=r,await e.save(),o.NextResponse.json({success:!0,message:"تم حذف الرد بنجاح"}))}let t=e.comments.findIndex(e=>e._id&&e._id.toString()===n);return -1===t?o.NextResponse.json({error:"التعليق غير موجود"},{status:404}):e.comments[t].author.userId!==i?o.NextResponse.json({error:"غير مصرح لك بحذف هذا التعليق"},{status:403}):(e.comments.splice(t,1),await e.save(),o.NextResponse.json({success:!0,message:"تم حذف التعليق بنجاح"}))})}catch(e){return console.error("Error deleting interaction:",e),o.NextResponse.json({error:"حدث خطأ أثناء حذف التفاعل"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/blog/interactions/route",pathname:"/api/blog/interactions",filename:"route",bundlePath:"app/api/blog/interactions/route"},resolvedPagePath:"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\api\\blog\\interactions\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:S}=f;function w(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},96487:()=>{},99493:(e,t,r)=>{"use strict";r.d(t,{P:()=>n,o:()=>s});var n=function(e){return e.GUIDE="guide",e.NEWS="news",e.TIPS="tips",e.ANALYSIS="analysis",e.MARKET="market",e.MEMES="memes",e.EXPERIENCE="experience",e}({}),s=function(e){return e.SWORD="sword",e.FIRE="fire",e.SHIELD="shield",e.CROWN="crown",e.CASTLE="castle",e.LAUGH="laugh",e}({})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7719,580],()=>r(87994));module.exports=n})();