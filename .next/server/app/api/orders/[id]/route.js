(()=>{var e={};e.id=7413,e.ids=[7413],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31098:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var o=t(56037),n=t.n(o);let s=new o.Schema({orderNumber:{type:String,required:!0,unique:!0},customer:{name:{type:String,required:!0},email:{type:String,required:!0},phone:{type:String,required:!0},address:{type:String,required:!0},city:{type:String,required:!0},notes:{type:String},paymentMethod:{type:String,required:!1}},items:[{id:{type:String,required:!0},name:{type:String,required:!0},price:{type:Number,required:!0},icon:{type:String,required:!0},quantity:{type:Number,required:!0,min:1},category:{type:String,required:!0,enum:["resources","bots","castle","events","packages"]}}],totalPrice:{type:Number,required:!0},status:{type:String,required:!0,enum:["pending","processing","completed","canceled"],default:"pending"},images:{coordImageUrl:{type:String},nameImageUrl:{type:String}}},{timestamps:!0}),i=n().models.Order||n().model("Order",s)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},88839:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var o=t(56037),n=t.n(o);let s=process.env.MONGODB_URI||"mongodb+srv://minaadelc4:cHjkStQnKuh91sNt@storefathone.a42qbk5.mongodb.net/storefathon?retryWrites=true&w=majority&appName=storefathone",i={connected:1,connecting:2},a=["منفصل","متصل","جاري الاتصال","جاري الانفصال"];if(!s)throw Error("يرجى تحديد رابط MONGODB_URI في ملف .env.local");let c=global.mongoose;c||(c=global.mongoose={conn:null,promise:null,errorCount:0,lastErrorTime:null});let l=async function(){if(c.conn)try{let e=c.conn.readyState;if(e===i.connected)return c.conn;console.log(`⚠️ حالة الاتصال بقاعدة البيانات غير صالحة (readyState=${e})، إعادة الاتصال...`),c.conn=null,c.promise=null}catch(e){console.error("❌ خطأ عند فحص حالة الاتصال الحالي:",e),c.conn=null,c.promise=null}if(c.lastErrorTime&&Date.now()-c.lastErrorTime>6e4&&(console.log("\uD83D\uDD04 إعادة ضبط عداد الأخطاء بعد مرور دقيقة"),c.errorCount=0,c.lastErrorTime=null),c.errorCount>5){let e=c.lastErrorTime?Math.floor((Date.now()-c.lastErrorTime)/1e3):0;if(console.error(`⛔ تجاوز الحد الأقصى لمحاولات الاتصال (${c.errorCount}). آخر محاولة منذ ${e} ثانية.`),e>60)console.log("\uD83D\uDD04 إعادة ضبط عداد محاولات الاتصال بعد فترة انتظار"),c.errorCount=0;else throw Error(`تجاوز الحد الأقصى لمحاولات الاتصال بقاعدة البيانات. حاول مرة أخرى لاحقًا (${Math.max(0,60-e)} ثانية متبقية)`)}c.promise?console.log("♻️ استخدام وعد اتصال موجود"):(console.log("\uD83D\uDD0D محاولة الاتصال بـ:",s.replace(/(mongodb\+srv:\/\/[^:]+):[^@]+@/,"$1:****@")),c.promise=n().connect(s,{bufferCommands:!0,serverSelectionTimeoutMS:2e4,connectTimeoutMS:2e4,socketTimeoutMS:6e4,family:4,maxPoolSize:10,retryWrites:!0,retryReads:!0}).then(e=>{let r=e.connection;return console.log(`🌿 تم الاتصال بقاعدة البيانات MongoDB بنجاح! (${r.name})`),r.on("error",e=>{console.error("❌ خطأ في اتصال قاعدة البيانات خلال التشغيل:",e)}),r.on("disconnected",()=>{console.warn("⚠️ انقطع الاتصال بقاعدة البيانات"),c.conn=null}),c.errorCount=0,c.lastErrorTime=null,r}).catch(e=>{throw c.errorCount++,c.lastErrorTime=Date.now(),console.error("❌ خطأ في الاتصال بقاعدة البيانات MongoDB:",e.message),"MongoServerSelectionError"===e.name&&(console.error("⚠️ خطأ اختيار السيرفر: تأكد من أن عنوان IP الخاص بك مسموح به في إعدادات الأمان لـ MongoDB Atlas"),console.error("\uD83D\uDCA1 اقتراح: اضبط Network Access في MongoDB Atlas للسماح لـ 0.0.0.0/0 للاختبار")),e.message.includes("Authentication failed")&&console.error("\uD83D\uDD11 فشل المصادقة: تأكد من صحة اسم المستخدم وكلمة المرور"),e.message.includes("getaddrinfo")&&console.error("\uD83C\uDF10 خطأ DNS: تأكد من اسم النطاق الصحيح وتوفر اتصال الإنترنت"),c.promise=null,e}));try{c.conn=await c.promise}catch(e){throw c.promise=null,e}let e=c.conn.readyState;if(e!==i.connected){console.warn(`⚠️ حالة الاتصال غير متوقعة: ${e}`);let r=a[e]||"غير معروفة";if(console.warn(`📊 حالة الاتصال: ${r}`),e===i.connecting){console.log("⏳ جاري الاتصال، الانتظار..."),await new Promise(e=>setTimeout(e,1e3));let e=c.conn.readyState;if(e===i.connected)console.log("✅ تم الاتصال بنجاح بعد الانتظار");else{let r=a[e]||"غير معروفة";console.warn(`⚠️ لا يزال الاتصال في حالة غير متوقعة: ${e} (${r})`)}}}return c.conn}},96487:()=>{},98847:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{GET:()=>u});var n=t(96559),s=t(48088),i=t(37719),a=t(32190),c=t(88839),l=t(31098);async function u(e,{params:r}){try{await (0,c.A)();let{id:e}=r;if(!e)return new a.NextResponse(JSON.stringify({error:"معرف الطلب مطلوب"}),{status:400,headers:{"Content-Type":"application/json; charset=utf-8"}});let t=await l.A.findById(e);if(!t)return new a.NextResponse(JSON.stringify({error:"لم يتم العثور على الطلب"}),{status:404,headers:{"Content-Type":"application/json; charset=utf-8"}});let o=t.toObject();return new a.NextResponse(JSON.stringify({order:{id:o._id.toString(),orderNumber:o.orderNumber,customer:o.customer,items:o.items,totalPrice:o.totalPrice,status:o.status,createdAt:o.createdAt,updatedAt:o.updatedAt}}),{headers:{"Content-Type":"application/json; charset=utf-8"}})}catch(e){return console.error("خطأ في جلب تفاصيل الطلب:",e),new a.NextResponse(JSON.stringify({error:"حدث خطأ أثناء جلب تفاصيل الطلب"}),{status:500,headers:{"Content-Type":"application/json; charset=utf-8"}})}}let d=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/orders/[id]/route",pathname:"/api/orders/[id]",filename:"route",bundlePath:"app/api/orders/[id]/route"},resolvedPagePath:"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\api\\orders\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:p,workUnitAsyncStorage:m,serverHooks:g}=d;function y(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:m})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[7719,580],()=>t(98847));module.exports=o})();