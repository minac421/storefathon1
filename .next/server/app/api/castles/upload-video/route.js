(()=>{var e={};e.id=221,e.ids=[221],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65003:(e,o,r)=>{"use strict";r.r(o),r.d(o,{patchFetch:()=>j,routeModule:()=>h,serverHooks:()=>S,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>$});var t={};r.r(t),r.d(t,{POST:()=>x});var s=r(96559),n=r(48088),a=r(37719),l=r(32190),i=r(88839),c=r(55511),u=r(29021),p=r.n(u),d=r(33873),m=r.n(d);let g=m().join(process.cwd(),"public","uploads","videos");async function w(){try{console.log(`Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªØ®Ø²ÙŠÙ†: ${g}`);let e=m().join(process.cwd(),"public","uploads");p().existsSync(e)||(console.log(`Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ uploads: ${e}`),await u.promises.mkdir(e,{recursive:!0})),p().existsSync(g)||(console.log(`Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ videos: ${g}`),await u.promises.mkdir(g,{recursive:!0})),console.log(`ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­`)}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:",e)}}let v=e=>{switch(e.split(".").pop()?.toLowerCase()){case"mp4":default:return"video/mp4";case"webm":return"video/webm";case"avi":return"video/x-msvideo";case"mov":return"video/quicktime"}},f=async(e,o)=>{try{await w();let r=await e.arrayBuffer(),t=Buffer.from(r),s=(0,c.randomUUID)(),n=e.name.split(".").pop()||"mp4",a=`castle_${o}_${s}.${n}`,l=m().join(g,a);await u.promises.writeFile(l,t);let i=v(e.name);{let e=`/uploads/videos/${a}`;return console.log(`ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ: ${l}`),console.log(`Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ù„ÙŠ: ${e}`),{url:e,contentType:i}}}catch(e){throw console.error(`Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:`,e),e}};async function x(e){try{await (0,i.A)();let o=await e.formData(),r=o.get("castleId"),t=o.get("video"),s=o.get("videoTitle")||"Castle Video";if(!r)return l.NextResponse.json({error:"Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù„Ø¹Ø© Ù…Ø·Ù„ÙˆØ¨"},{status:400});if(!t)return l.NextResponse.json({error:"Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø·Ù„ÙˆØ¨"},{status:400});console.log(`Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ù‚Ù„Ø¹Ø© ${r}`),console.log(`Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø±ÙÙˆØ¹: ${t.name} (${t.size} bytes)`);let{url:n,contentType:a}=await f(t,r);return l.NextResponse.json({success:!0,message:"ØªÙ… Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­",castleId:r,videoData:{url:n,title:s,contentType:a}},{status:200})}catch(e){return console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:",e),l.NextResponse.json({error:"ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/castles/upload-video/route",pathname:"/api/castles/upload-video",filename:"route",bundlePath:"app/api/castles/upload-video/route"},resolvedPagePath:"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\api\\castles\\upload-video\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:y,workUnitAsyncStorage:$,serverHooks:S}=h;function j(){return(0,a.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:$})}},78335:()=>{},88839:(e,o,r)=>{"use strict";r.d(o,{A:()=>c});var t=r(56037),s=r.n(t);let n=process.env.MONGODB_URI||"mongodb+srv://minaadelc4:cHjkStQnKuh91sNt@storefathone.a42qbk5.mongodb.net/storefathon?retryWrites=true&w=majority&appName=storefathone",a={connected:1,connecting:2},l=["Ù…Ù†ÙØµÙ„","Ù…ØªØµÙ„","Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„","Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ÙØµØ§Ù„"];if(!n)throw Error("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø±Ø§Ø¨Ø· MONGODB_URI ÙÙŠ Ù…Ù„Ù .env.local");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null,errorCount:0,lastErrorTime:null});let c=async function(){if(i.conn)try{let e=i.conn.readyState;if(e===a.connected)return i.conn;console.log(`âš ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø© (readyState=${e})ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...`),i.conn=null,i.promise=null}catch(e){console.error("âŒ Ø®Ø·Ø£ Ø¹Ù†Ø¯ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ:",e),i.conn=null,i.promise=null}if(i.lastErrorTime&&Date.now()-i.lastErrorTime>6e4&&(console.log("\uD83D\uDD04 Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø¹Ø¯ Ù…Ø±ÙˆØ± Ø¯Ù‚ÙŠÙ‚Ø©"),i.errorCount=0,i.lastErrorTime=null),i.errorCount>5){let e=i.lastErrorTime?Math.floor((Date.now()-i.lastErrorTime)/1e3):0;if(console.error(`â›” ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ (${i.errorCount}). Ø¢Ø®Ø± Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ù†Ø° ${e} Ø«Ø§Ù†ÙŠØ©.`),e>60)console.log("\uD83D\uDD04 Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø¹Ø¯Ø§Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ø§Ù†ØªØ¸Ø§Ø±"),i.errorCount=0;else throw Error(`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§ (${Math.max(0,60-e)} Ø«Ø§Ù†ÙŠØ© Ù…ØªØ¨Ù‚ÙŠØ©)`)}i.promise?console.log("â™»ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ¹Ø¯ Ø§ØªØµØ§Ù„ Ù…ÙˆØ¬ÙˆØ¯"):(console.log("\uD83D\uDD0D Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€:",n.replace(/(mongodb\+srv:\/\/[^:]+):[^@]+@/,"$1:****@")),i.promise=s().connect(n,{bufferCommands:!0,serverSelectionTimeoutMS:2e4,connectTimeoutMS:2e4,socketTimeoutMS:6e4,family:4,maxPoolSize:10,retryWrites:!0,retryReads:!0}).then(e=>{let o=e.connection;return console.log(`ðŸŒ¿ ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª MongoDB Ø¨Ù†Ø¬Ø§Ø­! (${o.name})`),o.on("error",e=>{console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„:",e)}),o.on("disconnected",()=>{console.warn("âš ï¸ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"),i.conn=null}),i.errorCount=0,i.lastErrorTime=null,o}).catch(e=>{throw i.errorCount++,i.lastErrorTime=Date.now(),console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª MongoDB:",e.message),"MongoServerSelectionError"===e.name&&(console.error("âš ï¸ Ø®Ø·Ø£ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±: ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ù„Ù€ MongoDB Atlas"),console.error("\uD83D\uDCA1 Ø§Ù‚ØªØ±Ø§Ø­: Ø§Ø¶Ø¨Ø· Network Access ÙÙŠ MongoDB Atlas Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù€ 0.0.0.0/0 Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±")),e.message.includes("Authentication failed")&&console.error("\uD83D\uDD11 ÙØ´Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"),e.message.includes("getaddrinfo")&&console.error("\uD83C\uDF10 Ø®Ø·Ø£ DNS: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØµØ­ÙŠØ­ ÙˆØªÙˆÙØ± Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª"),i.promise=null,e}));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}let e=i.conn.readyState;if(e!==a.connected){console.warn(`âš ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©: ${e}`);let o=l[e]||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©";if(console.warn(`ðŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: ${o}`),e===a.connecting){console.log("â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."),await new Promise(e=>setTimeout(e,1e3));let e=i.conn.readyState;if(e===a.connected)console.log("âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±");else{let o=l[e]||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©";console.warn(`âš ï¸ Ù„Ø§ ÙŠØ²Ø§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙŠ Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©: ${e} (${o})`)}}}return i.conn}},96487:()=>{}};var o=require("../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[7719,580],()=>r(65003));module.exports=t})();