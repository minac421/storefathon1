(()=>{var e={};e.id=745,e.ids=[745],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},52864:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var o=r(56037),n=r.n(o);let s=new(n()).Schema({name:{type:String,required:[!0,"الرجاء إدخال اسم القلعة"],trim:!0},description:{type:String,required:[!0,"الرجاء إدخال وصف القلعة"]},level:{type:Number,required:[!0,"الرجاء تحديد مستوى القلعة"],min:1},strength:{type:Number,required:[!0,"الرجاء تحديد قوة القلعة"],min:1},price:{type:Number,required:[!0,"الرجاء تحديد سعر القلعة"],min:0},features:[{type:String,trim:!0}],icon:{type:String,default:"\uD83C\uDFF0"},popular:{type:Boolean,default:!1},videoUrl:{type:String},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{timestamps:!0});s.index({name:"text",description:"text"});let a=n().models.Castle||n().model("Castle",s)},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71812:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>g,serverHooks:()=>h,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>y});var o={};r.r(o),r.d(o,{DELETE:()=>m,GET:()=>u,POST:()=>p,PUT:()=>d});var n=r(96559),s=r(48088),a=r(37719),i=r(32190),c=r(88839),l=r(52864);async function u(e){try{await (0,c.A)();let t=new URL(e.url),r=t.searchParams.get("level"),o=t.searchParams.get("sortBy")||"createdAt",n=t.searchParams.get("sortOrder")||"desc",s={};r&&(s.level=parseInt(r));let a={};a[o]="asc"===n?1:-1;let u=await l.A.countDocuments(s),p=(await l.A.find(s).sort(a).limit(500)).map(e=>{let t=e.toObject();return{id:t._id.toString(),name:t.name,description:t.description,level:t.level,strength:t.strength,price:t.price,features:t.features||[],icon:t.icon||"\uD83C\uDFF0",popular:t.popular||!1,videoUrl:t.videoUrl||""}});return new i.NextResponse(JSON.stringify({castles:p,stats:{totalCastles:u}}),{headers:{"Content-Type":"application/json; charset=utf-8"}})}catch(t){console.error("خطأ في جلب القلاع:",t);let e=[{id:"1",name:"قلعة الفاتح الأولى",description:"قلعة قوية ومحصنة توفر حماية ممتازة للاعبين الجدد. تتميز بجدران سميكة وموقع استراتيجي.",level:10,strength:75,price:1500,features:["جدران محصنة","أبراج مراقبة","خندق دفاعي","مخزن موارد صغير"],icon:"\uD83C\uDFF0",popular:!0,videoUrl:""},{id:"2",name:"قلعة المحارب",description:"قلعة متوسطة الحجم مناسبة للاعبين من المستوى المتوسط. توفر توازنًا جيدًا بين الدفاع والهجوم.",level:20,strength:85,price:3500,features:["حواجز دفاعية متقدمة","مركز تدريب للجنود","مخزن موارد متوسط","أسلحة دفاعية متطورة","مركز قيادة تكتيكي"],icon:"\uD83C\uDFF0",popular:!1,videoUrl:""},{id:"3",name:"قلعة الفاتح الذهبية",description:"قلعة فاخرة للاعبين المتقدمين. توفر أقصى مستويات الحماية والقدرة الهجومية.",level:35,strength:100,price:1e4,features:["دفاعات ذكية متقدمة","مركز أبحاث عسكري","مخزن موارد ضخم","دفاعات مضادة للطائرات","مركز قيادة استراتيجي","درع وقائي متطور"],icon:"\uD83C\uDFF0",popular:!0,videoUrl:""}];return new i.NextResponse(JSON.stringify({castles:e,stats:{totalCastles:e.length}}),{headers:{"Content-Type":"application/json; charset=utf-8"}})}}async function p(e){try{await (0,c.A)();let t=await e.json(),r=await l.A.create(t);return new i.NextResponse(JSON.stringify({id:r._id.toString(),success:!0}),{headers:{"Content-Type":"application/json; charset=utf-8"}})}catch(e){return console.error("خطأ في إضافة قلعة جديدة:",e),new i.NextResponse(JSON.stringify({error:"حدث خطأ أثناء إضافة قلعة جديدة"}),{status:500,headers:{"Content-Type":"application/json; charset=utf-8"}})}}async function d(e){try{await (0,c.A)();let{id:t,...r}=await e.json();return await l.A.findByIdAndUpdate(t,{...r,updatedAt:new Date}),i.NextResponse.json({success:!0})}catch(e){return console.error("خطأ في تحديث القلعة:",e),new i.NextResponse(JSON.stringify({error:"حدث خطأ أثناء تحديث القلعة"}),{status:500,headers:{"Content-Type":"application/json; charset=utf-8"}})}}async function m(e){try{await (0,c.A)();let t=new URL(e.url).searchParams.get("id");if(!t)return new i.NextResponse(JSON.stringify({error:"معرف القلعة مطلوب"}),{status:400,headers:{"Content-Type":"application/json; charset=utf-8"}});return await l.A.findByIdAndDelete(t),i.NextResponse.json({success:!0})}catch(e){return console.error("خطأ في حذف القلعة:",e),new i.NextResponse(JSON.stringify({error:"حدث خطأ أثناء حذف القلعة"}),{status:500,headers:{"Content-Type":"application/json; charset=utf-8"}})}}let g=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/castles/route",pathname:"/api/castles",filename:"route",bundlePath:"app/api/castles/route"},resolvedPagePath:"C:\\Users\\minaa\\CascadeProjects\\conquerors-website\\src\\app\\api\\castles\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:f,workUnitAsyncStorage:y,serverHooks:h}=g;function w(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:y})}},78335:()=>{},88839:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var o=r(56037),n=r.n(o);let s=process.env.MONGODB_URI||"mongodb+srv://minaadelc4:cHjkStQnKuh91sNt@storefathone.a42qbk5.mongodb.net/storefathon?retryWrites=true&w=majority&appName=storefathone",a={connected:1,connecting:2},i=["منفصل","متصل","جاري الاتصال","جاري الانفصال"];if(!s)throw Error("يرجى تحديد رابط MONGODB_URI في ملف .env.local");let c=global.mongoose;c||(c=global.mongoose={conn:null,promise:null,errorCount:0,lastErrorTime:null});let l=async function(){if(c.conn)try{let e=c.conn.readyState;if(e===a.connected)return c.conn;console.log(`⚠️ حالة الاتصال بقاعدة البيانات غير صالحة (readyState=${e})، إعادة الاتصال...`),c.conn=null,c.promise=null}catch(e){console.error("❌ خطأ عند فحص حالة الاتصال الحالي:",e),c.conn=null,c.promise=null}if(c.lastErrorTime&&Date.now()-c.lastErrorTime>6e4&&(console.log("\uD83D\uDD04 إعادة ضبط عداد الأخطاء بعد مرور دقيقة"),c.errorCount=0,c.lastErrorTime=null),c.errorCount>5){let e=c.lastErrorTime?Math.floor((Date.now()-c.lastErrorTime)/1e3):0;if(console.error(`⛔ تجاوز الحد الأقصى لمحاولات الاتصال (${c.errorCount}). آخر محاولة منذ ${e} ثانية.`),e>60)console.log("\uD83D\uDD04 إعادة ضبط عداد محاولات الاتصال بعد فترة انتظار"),c.errorCount=0;else throw Error(`تجاوز الحد الأقصى لمحاولات الاتصال بقاعدة البيانات. حاول مرة أخرى لاحقًا (${Math.max(0,60-e)} ثانية متبقية)`)}c.promise?console.log("♻️ استخدام وعد اتصال موجود"):(console.log("\uD83D\uDD0D محاولة الاتصال بـ:",s.replace(/(mongodb\+srv:\/\/[^:]+):[^@]+@/,"$1:****@")),c.promise=n().connect(s,{bufferCommands:!0,serverSelectionTimeoutMS:2e4,connectTimeoutMS:2e4,socketTimeoutMS:6e4,family:4,maxPoolSize:10,retryWrites:!0,retryReads:!0}).then(e=>{let t=e.connection;return console.log(`🌿 تم الاتصال بقاعدة البيانات MongoDB بنجاح! (${t.name})`),t.on("error",e=>{console.error("❌ خطأ في اتصال قاعدة البيانات خلال التشغيل:",e)}),t.on("disconnected",()=>{console.warn("⚠️ انقطع الاتصال بقاعدة البيانات"),c.conn=null}),c.errorCount=0,c.lastErrorTime=null,t}).catch(e=>{throw c.errorCount++,c.lastErrorTime=Date.now(),console.error("❌ خطأ في الاتصال بقاعدة البيانات MongoDB:",e.message),"MongoServerSelectionError"===e.name&&(console.error("⚠️ خطأ اختيار السيرفر: تأكد من أن عنوان IP الخاص بك مسموح به في إعدادات الأمان لـ MongoDB Atlas"),console.error("\uD83D\uDCA1 اقتراح: اضبط Network Access في MongoDB Atlas للسماح لـ 0.0.0.0/0 للاختبار")),e.message.includes("Authentication failed")&&console.error("\uD83D\uDD11 فشل المصادقة: تأكد من صحة اسم المستخدم وكلمة المرور"),e.message.includes("getaddrinfo")&&console.error("\uD83C\uDF10 خطأ DNS: تأكد من اسم النطاق الصحيح وتوفر اتصال الإنترنت"),c.promise=null,e}));try{c.conn=await c.promise}catch(e){throw c.promise=null,e}let e=c.conn.readyState;if(e!==a.connected){console.warn(`⚠️ حالة الاتصال غير متوقعة: ${e}`);let t=i[e]||"غير معروفة";if(console.warn(`📊 حالة الاتصال: ${t}`),e===a.connecting){console.log("⏳ جاري الاتصال، الانتظار..."),await new Promise(e=>setTimeout(e,1e3));let e=c.conn.readyState;if(e===a.connected)console.log("✅ تم الاتصال بنجاح بعد الانتظار");else{let t=i[e]||"غير معروفة";console.warn(`⚠️ لا يزال الاتصال في حالة غير متوقعة: ${e} (${t})`)}}}return c.conn}},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7719,580],()=>r(71812));module.exports=o})();