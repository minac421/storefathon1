{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/minaa/CascadeProjects/conquerors-website/src/lib/dbConnect.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\n// ุงูุฑุงุจุท ุงูุฎุงุต ุจูุงุนุฏุฉ ุงูุจูุงูุงุช MongoDB Atlas - ุงุณุชุฎุฏู ุงููุชุบูุฑ ุงูุจูุฆู ุฃููุงู\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb+srv://minaadelc4:cHjkStQnKuh91sNt@storefathone.a42qbk5.mongodb.net/storefathon?retryWrites=true&w=majority&appName=storefathone';\n\n/**\n * ุชุนุฑูู ุญุงูุงุช ุงูุงุชุตุงู ููุงุนุฏุฉ ุงูุจูุงูุงุช\n */\n// ูุฌุจ ุงุณุชุฎุฏุงู ููุณ ุงูููู ุงูุนุฏุฏูุฉ ุงูุชู ูุณุชุฎุฏููุง Mongoose\nconst MONGOOSE_STATES = {\n  disconnected: 0,\n  connected: 1,\n  connecting: 2,\n  disconnecting: 3,\n} as const;\n\n// ุชุฑุฌูุฉ ุญุงูุงุช ุงูุงุชุตุงู ุฅูู ุงูุนุฑุจูุฉ\nconst CONNECTION_STATE_NAMES = [\n  'ูููุตู',        // 0\n  'ูุชุตู',         // 1\n  'ุฌุงุฑู ุงูุงุชุตุงู', // 2\n  'ุฌุงุฑู ุงูุงููุตุงู' // 3\n];\n\n/**\n * ุงูุงุชุตุงู ุงูุนูููู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช\n * ุณูุชู ุงุณุชุฎุฏุงูู ูู ุฌููุน ุฃูุญุงุก ุงูุชุทุจูู\n * \n * ููุงุญุธุฉ ูุงูุฉ: ูุฌุจ ุงูุชุฃูุฏ ูู ุฃู ุงูุฅุนุฏุงุฏุงุช ุงูุฃูููุฉ ูู MongoDB Atlas ุชุณูุญ ุจุงุชุตุงู ูู IP ุงูุฎุงุฏู\n * ุชุฃูุฏ ูู ุฅุถุงูุฉ IP ุงูุฎุงุฏู ูู Network Access ูู MongoDB Atlas\n * ูุฅุฐุง ููุช ุชุณุชุฎุฏู Vercelุ ูุชุฃูุฏ ูู ุฅุถุงูุฉ 0.0.0.0/0 ููุณูุงุญ ุจุงููุตูู ูู ุฌููุน ุนูุงููู IP\n */\nif (!MONGODB_URI) {\n  throw new Error('ูุฑุฌู ุชุญุฏูุฏ ุฑุงุจุท MONGODB_URI ูู ููู .env.local');\n}\n\n/**\n * ูุชุบูุฑ ุนูููู ููุญุงูุฉ ูู ุงููุทุงู ุงูุนูููู\n * ูููุน ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูู ูู ูุฑุฉ ูุชู ูููุง ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ\n */\ninterface Cached {\n  conn: mongoose.Connection | null;\n  promise: Promise<mongoose.Connection> | null;\n  errorCount: number;\n  lastErrorTime: number | null;\n}\n\ndeclare global {\n  // eslint-disable-next-line\n  var mongoose: { \n    conn: mongoose.Connection | null; \n    promise: Promise<mongoose.Connection> | null;\n    errorCount: number;\n    lastErrorTime: number | null;\n  };\n}\n\n// ุชููุฆุฉ ุงููุงุด ุงูุนูููู\nlet cached: Cached = global.mongoose as Cached;\n\nif (!cached) {\n  cached = global.mongoose = { \n    conn: null, \n    promise: null, \n    errorCount: 0,\n    lastErrorTime: null \n  };\n}\n\n/**\n * ุฏุงูุฉ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช\n * ุชุนูุฏ ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃู ุชุฑูู ุฎุทุฃ ุฅุฐุง ูุดู ุงูุงุชุตุงู ุจุนุฏ ุนุฏุฉ ูุญุงููุงุช\n */\nasync function dbConnect(): Promise<mongoose.Connection> {\n  // ุงูุชุญูู ุฅุฐุง ูุงู ุงูุงุชุตุงู ููุฌูุฏูุง ุจุงููุนู\n  if (cached.conn) {\n    // ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุงููุงุฆู\n    try {\n      const currentState = cached.conn.readyState;\n      \n      if (currentState === MONGOOSE_STATES.connected) {\n        return cached.conn;\n      } else {\n        console.log(`โ๏ธ ุญุงูุฉ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ุตุงูุญุฉ (readyState=${currentState})ุ ุฅุนุงุฏุฉ ุงูุงุชุตุงู...`);\n        cached.conn = null;\n        cached.promise = null;\n      }\n    } catch (connError) {\n      console.error('โ ุฎุทุฃ ุนูุฏ ูุญุต ุญุงูุฉ ุงูุงุชุตุงู ุงูุญุงูู:', connError);\n      cached.conn = null;\n      cached.promise = null;\n    }\n  }\n\n  // ุงูุชุญูู ูู ููุช ุญุฏูุซ ุขุฎุฑ ุฎุทุฃ - ุฅุนุงุฏุฉ ุถุจุท ุนุฏุงุฏ ุงูุฃุฎุทุงุก ุฅุฐุง ูุฑ ููุช ูุงูู\n  if (cached.lastErrorTime && Date.now() - cached.lastErrorTime > 60000) {\n    console.log('๐ ุฅุนุงุฏุฉ ุถุจุท ุนุฏุงุฏ ุงูุฃุฎุทุงุก ุจุนุฏ ูุฑูุฑ ุฏูููุฉ');\n    cached.errorCount = 0;\n    cached.lastErrorTime = null;\n  }\n\n  // ุงูุชุญูู ูู ุนุฏุฏ ุงููุญุงููุงุช ุงููุชูุฑุฑุฉ\n  if (cached.errorCount > 5) {\n    const timeSinceLastError = cached.lastErrorTime ? Math.floor((Date.now() - cached.lastErrorTime) / 1000) : 0;\n    console.error(`โ ุชุฌุงูุฒ ุงูุญุฏ ุงูุฃูุตู ููุญุงููุงุช ุงูุงุชุตุงู (${cached.errorCount}). ุขุฎุฑ ูุญุงููุฉ ููุฐ ${timeSinceLastError} ุซุงููุฉ.`);\n    \n    // ุฅุนุงุฏุฉ ุชุนููู ุงูุนุฏุงุฏ ุจุนุฏ 1 ุฏูููุฉ\n    if (timeSinceLastError > 60) {\n      console.log('๐ ุฅุนุงุฏุฉ ุถุจุท ุนุฏุงุฏ ูุญุงููุงุช ุงูุงุชุตุงู ุจุนุฏ ูุชุฑุฉ ุงูุชุธุงุฑ');\n      cached.errorCount = 0;\n    } else {\n      throw new Error(`ุชุฌุงูุฒ ุงูุญุฏ ุงูุฃูุตู ููุญุงููุงุช ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช. ุญุงูู ูุฑุฉ ุฃุฎุฑู ูุงุญููุง (${Math.max(0, 60 - timeSinceLastError)} ุซุงููุฉ ูุชุจููุฉ)`);\n    }\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: true,\n      serverSelectionTimeoutMS: 20000, // ุฒูุงุฏุฉ ูููุฉ ุงุชุตุงู ุงูุณูุฑูุฑ ุฅูู 20 ุซุงููุฉ\n      connectTimeoutMS: 20000, // ุฒูุงุฏุฉ ูููุฉ ุงูุงุชุตุงู ุฅูู 20 ุซุงููุฉ\n      socketTimeoutMS: 60000, // ุฒูุงุฏุฉ ูููุฉ ุงูุชูุงุก ูุฏุฉ ุงูุจุญุซ ุนู ุงูุณูุฑูุฑ ุฅูู 60 ุซุงููุฉ\n      family: 4, // ุงุณุชุฎุฏุงู IPv4 ุจุฏูุงู ูู IPv6\n      maxPoolSize: 10, // ุชุญุฏูุฏ ุงูุญุฏ ุงูุฃูุตู ูุนุฏุฏ ุงูุงุชุตุงูุงุช ูู ุงููุฌูุน\n      retryWrites: true, // ุฅุนุงุฏุฉ ูุญุงููุฉ ุงููุชุงุจุฉ ุชููุงุฆููุง\n      retryReads: true, // ุฅุนุงุฏุฉ ูุญุงููุฉ ุงููุฑุงุกุฉ ุชููุงุฆููุง\n    };\n\n    // ุทุจุงุนุฉ ุงูุฑุงุจุท ููุชุญูู ููู (ูุน ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ ููุฃูุงู)\n    const sanitizedUri = MONGODB_URI.replace(/(mongodb\\+srv:\\/\\/[^:]+):[^@]+@/, '$1:****@');\n    console.log('๐ ูุญุงููุฉ ุงูุงุชุตุงู ุจู:', sanitizedUri);\n    \n    // ูุนุงูุฌุฉ ุงูุงุชุตุงู ุจุดูู ุฃูุถู\n    cached.promise = mongoose.connect(MONGODB_URI, opts)\n      .then((mongoose) => {\n        const connection = mongoose.connection;\n        console.log(`๐ฟ ุชู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช MongoDB ุจูุฌุงุญ! (${connection.name})`);\n        \n        // ุฅุถุงูุฉ ูุณุชูุน ูุฃุญุฏุงุซ ุงูุฎุทุฃ\n        connection.on('error', (err) => {\n          console.error('โ ุฎุทุฃ ูู ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฎูุงู ุงูุชุดุบูู:', err);\n        });\n        \n        connection.on('disconnected', () => {\n          console.warn('โ๏ธ ุงููุทุน ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช');\n          cached.conn = null;\n        });\n        \n        // ุฅุนุงุฏุฉ ุชุนููู ุนุฏุงุฏ ุงูุฃุฎุทุงุก ุนูุฏ ูุฌุงุญ ุงูุงุชุตุงู\n        cached.errorCount = 0;\n        cached.lastErrorTime = null;\n        return connection;\n      })\n      .catch((error) => {\n        // ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุฃุฎุทุงุก ูุชุณุฌูู ููุช ุขุฎุฑ ุฎุทุฃ\n        cached.errorCount++;\n        cached.lastErrorTime = Date.now();\n        \n        console.error('โ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช MongoDB:', error.message);\n        \n        // ุชุญูู ูู ููุน ุงูุฎุทุฃ ูุชูุฏูู ุฑุณุงุฆู ูููุฏุฉ\n        if (error.name === 'MongoServerSelectionError') {\n          console.error('โ๏ธ ุฎุทุฃ ุงุฎุชูุงุฑ ุงูุณูุฑูุฑ: ุชุฃูุฏ ูู ุฃู ุนููุงู IP ุงูุฎุงุต ุจู ูุณููุญ ุจู ูู ุฅุนุฏุงุฏุงุช ุงูุฃูุงู ูู MongoDB Atlas');\n          console.error('๐ก ุงูุชุฑุงุญ: ุงุถุจุท Network Access ูู MongoDB Atlas ููุณูุงุญ ูู 0.0.0.0/0 ููุงุฎุชุจุงุฑ');\n        }\n        if (error.message.includes('Authentication failed')) {\n          console.error('๐ ูุดู ุงููุตุงุฏูุฉ: ุชุฃูุฏ ูู ุตุญุฉ ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ');\n        }\n        if (error.message.includes('getaddrinfo')) {\n          console.error('๐ ุฎุทุฃ DNS: ุชุฃูุฏ ูู ุงุณู ุงููุทุงู ุงูุตุญูุญ ูุชููุฑ ุงุชุตุงู ุงูุฅูุชุฑูุช');\n        }\n        \n        // ุฅุนุงุฏุฉ ุชุนููู ุงููุนุฏ ููุณูุงุญ ุจุงููุญุงููุฉ ุงูุชุงููุฉ\n        cached.promise = null;\n        throw error;\n      });\n  } else {\n    console.log('โป๏ธ ุงุณุชุฎุฏุงู ูุนุฏ ุงุชุตุงู ููุฌูุฏ');\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    // ุฅุนุงุฏุฉ ุถุจุท ุงููุนุฏ ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃ\n    cached.promise = null;\n    throw e;\n  }\n\n  // ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุชุตุงู\n  const connectionState = cached.conn.readyState;\n  \n  if (connectionState !== MONGOOSE_STATES.connected) {\n    console.warn(`โ๏ธ ุญุงูุฉ ุงูุงุชุตุงู ุบูุฑ ูุชููุนุฉ: ${connectionState}`);\n    \n    // ุนุฑุถ ุงุณู ุญุงูุฉ ุงูุงุชุตุงู\n    const stateName = CONNECTION_STATE_NAMES[connectionState] || 'ุบูุฑ ูุนุฑููุฉ';\n    console.warn(`๐ ุญุงูุฉ ุงูุงุชุตุงู: ${stateName}`);\n    \n    // ุฅุฐุง ูุงูุช ุงูุญุงูุฉ \"ุฌุงุฑู ุงูุงุชุตุงู\"ุ ุงูุชุธุฑ ููููุงู\n    if (connectionState === MONGOOSE_STATES.connecting) {\n      console.log('โณ ุฌุงุฑู ุงูุงุชุตุงูุ ุงูุงูุชุธุงุฑ...');\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      // ุงูุชุญูู ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุงูุงูุชุธุงุฑ\n      const newState = cached.conn.readyState;\n      if (newState === MONGOOSE_STATES.connected) {\n        console.log('โ ุชู ุงูุงุชุตุงู ุจูุฌุงุญ ุจุนุฏ ุงูุงูุชุธุงุฑ');\n      } else {\n        const newStateName = CONNECTION_STATE_NAMES[newState] || 'ุบูุฑ ูุนุฑููุฉ';\n        console.warn(`โ๏ธ ูุง ูุฒุงู ุงูุงุชุตุงู ูู ุญุงูุฉ ุบูุฑ ูุชููุนุฉ: ${newState} (${newStateName})`);\n      }\n    }\n  }\n\n  return cached.conn;\n}\n\nexport default dbConnect;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/minaa/CascadeProjects/conquerors-website/src/models/ChatMessage.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\n\r\n// ุชุนุฑูู ูุงุฌูุฉ ุงูุฑุณุงูุฉ\r\nexport interface IChatMessage extends Document {\r\n  sender: string;\r\n  senderAvatarId: number;\r\n  message: string;\r\n  timestamp: string;\r\n  interaction: {\r\n    likes: string[];\r\n    isLiked: boolean;\r\n  };\r\n}\r\n\r\n// ุชุนุฑูู ุณูููุง ุงูุฑุณุงูุฉ\r\nconst ChatMessageSchema: Schema = new Schema({\r\n  sender: {\r\n    type: String,\r\n    required: true,\r\n    trim: true\r\n  },\r\n  senderAvatarId: {\r\n    type: Number,\r\n    required: true,\r\n    default: 1\r\n  },\r\n  message: {\r\n    type: String,\r\n    required: true,\r\n    trim: true\r\n  },\r\n  timestamp: {\r\n    type: String,\r\n    required: true,\r\n    default: () => new Date().toISOString()\r\n  },\r\n  interaction: {\r\n    likes: {\r\n      type: [String],\r\n      default: []\r\n    },\r\n    isLiked: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  }\r\n}, {\r\n  timestamps: true,\r\n  versionKey: false\r\n});\r\n\r\n// ุชุนุฑูู ุงููููุฐุฌ\r\nlet ChatMessageModel: mongoose.Model<IChatMessage>;\r\n\r\ntry {\r\n  // ูุญุงููุฉ ุงูุญุตูู ุนูู ุงููููุฐุฌ ุฅุฐุง ูุงู ููุฌูุฏุงู ุจุงููุนู\r\n  ChatMessageModel = mongoose.model<IChatMessage>('ChatMessage');\r\n} catch {\r\n  // ุฅูุดุงุก ุงููููุฐุฌ ุฅุฐุง ูู ููู ููุฌูุฏุงู\r\n  ChatMessageModel = mongoose.model<IChatMessage>('ChatMessage', ChatMessageSchema);\r\n}\r\n\r\nexport default ChatMessageModel; "],"names":[],"mappings":";;;AAAA;;AAcA,sBAAsB;AACtB,MAAM,oBAA4B,IAAI,yGAAA,CAAA,SAAM,CAAC;IAC3C,QAAQ;QACN,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,gBAAgB;QACd,MAAM;QACN,UAAU;QACV,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,SAAS,IAAM,IAAI,OAAO,WAAW;IACvC;IACA,aAAa;QACX,OAAO;YACL,MAAM;gBAAC;aAAO;YACd,SAAS,EAAE;QACb;QACA,SAAS;YACP,MAAM;YACN,SAAS;QACX;IACF;AACF,GAAG;IACD,YAAY;IACZ,YAAY;AACd;AAEA,gBAAgB;AAChB,IAAI;AAEJ,IAAI;IACF,mDAAmD;IACnD,mBAAmB,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAe;AAClD,EAAE,OAAM;IACN,mCAAmC;IACnC,mBAAmB,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAe,eAAe;AACjE;uCAEe","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/minaa/CascadeProjects/conquerors-website/src/app/api/socket/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport dbConnect from '@/lib/dbConnect';\r\nimport ChatMessageModel from '@/models/ChatMessage';\r\n\r\n// ุชูููุฑ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ููุฏุฑุฏุดุฉ\r\n// ูุชู ุงุณุชุฎุฏุงูู ูุน Socket.IO ุฃู ูููุทุฉ ููุงูุฉ ูุจุงุดุฑุฉ ููุฏุฑุฏุดุฉ\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    // ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช\r\n    await dbConnect();\r\n    \r\n    // ูุฑุงุกุฉ ุขุฎุฑ ุงูุฑุณุงุฆู - ุงูุชุฑุงุถูุงู 20 ุฑุณุงูุฉ\r\n    const messages = await ChatMessageModel.find({})\r\n      .sort({ timestamp: -1 })\r\n      .limit(20)\r\n      .lean();\r\n    \r\n    // ุชุฑุชูุจ ุงูุฑุณุงุฆู ูู ุงูุฃูุฏู ุฅูู ุงูุฃุญุฏุซ ููุนุฑุถ\r\n    const sortedMessages = [...messages].sort((a, b) => \r\n      new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()\r\n    );\r\n    \r\n    // ุฅูุดุงุก ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุงููุชุตููู ูู ุงูุฑุณุงุฆู ุงููุนููุฉ ููุท\r\n    const users = Array.from(new Set(sortedMessages.map(msg => msg.sender)))\r\n      .filter(username => username) // ุชุฃูุฏ ูู ุฃู ุงุณู ุงููุณุชุฎุฏู ููุฌูุฏ\r\n      .map(username => {\r\n        const matchingMsg = sortedMessages.find(msg => msg.sender === username);\r\n        return {\r\n          name: username,\r\n          avatarId: matchingMsg?.senderAvatarId || 1,\r\n          status: 'online'\r\n        };\r\n      });\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      messages: sortedMessages,\r\n      users,\r\n      mode: 'api',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  } catch (error) {\r\n    console.error('Error fetching chat messages:', error);\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: 'ูุดู ูู ุฌูุจ ุจูุงูุงุช ุงูุฏุฑุฏุดุฉ',\r\n      mode: 'error',\r\n      message: error.message\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    // ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช\r\n    await dbConnect();\r\n    \r\n    const body = await request.json();\r\n    \r\n    // ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุงูุงุช ุงููุทููุจุฉ\r\n    if (!body.message || !body.sender) {\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: 'ุจูุงูุงุช ุบูุฑ ููุชููุฉ',\r\n        mode: 'error'\r\n      }, { status: 400 });\r\n    }\r\n    \r\n    // ุฅุถุงูุฉ ุฑุณุงูุฉ ุฌุฏูุฏุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช\r\n    const newMessage = {\r\n      sender: body.sender,\r\n      senderAvatarId: body.senderAvatarId || 1,\r\n      message: body.message,\r\n      timestamp: new Date().toISOString(),\r\n      interaction: {\r\n        likes: [],\r\n        isLiked: false\r\n      }\r\n    };\r\n    \r\n    const savedMessage = await ChatMessageModel.create(newMessage);\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      message: savedMessage,\r\n      mode: 'api'\r\n    });\r\n  } catch (error) {\r\n    console.error('Error adding message:', error);\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: 'ูุดู ูู ุฅุถุงูุฉ ุงูุฑุณุงูุฉ',\r\n      mode: 'error',\r\n      message: error.message\r\n    }, { status: 500 });\r\n  }\r\n} "],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAKO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,0BAA0B;QAC1B,MAAM,CAAA,GAAA,yHAAA,CAAA,UAAS,AAAD;QAEd,yCAAyC;QACzC,MAAM,WAAW,MAAM,8HAAA,CAAA,UAAgB,CAAC,IAAI,CAAC,CAAC,GAC3C,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE,GACrB,KAAK,CAAC,IACN,IAAI;QAEP,2CAA2C;QAC3C,MAAM,iBAAiB;eAAI;SAAS,CAAC,IAAI,CAAC,CAAC,GAAG,IAC5C,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QAGjE,yDAAyD;QACzD,MAAM,QAAQ,MAAM,IAAI,CAAC,IAAI,IAAI,eAAe,GAAG,CAAC,CAAA,MAAO,IAAI,MAAM,IAClE,MAAM,CAAC,CAAA,WAAY,UAAU,gCAAgC;SAC7D,GAAG,CAAC,CAAA;YACH,MAAM,cAAc,eAAe,IAAI,CAAC,CAAA,MAAO,IAAI,MAAM,KAAK;YAC9D,OAAO;gBACL,MAAM;gBACN,UAAU,aAAa,kBAAkB;gBACzC,QAAQ;YACV;QACF;QAEF,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU;YACV;YACA,MAAM;YACN,WAAW,IAAI,OAAO,WAAW;QACnC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;YACP,MAAM;YACN,SAAS,MAAM,OAAO;QACxB,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,0BAA0B;QAC1B,MAAM,CAAA,GAAA,yHAAA,CAAA,UAAS,AAAD;QAEd,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,mCAAmC;QACnC,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,KAAK,MAAM,EAAE;YACjC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,MAAM;YACR,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,uCAAuC;QACvC,MAAM,aAAa;YACjB,QAAQ,KAAK,MAAM;YACnB,gBAAgB,KAAK,cAAc,IAAI;YACvC,SAAS,KAAK,OAAO;YACrB,WAAW,IAAI,OAAO,WAAW;YACjC,aAAa;gBACX,OAAO,EAAE;gBACT,SAAS;YACX;QACF;QAEA,MAAM,eAAe,MAAM,8HAAA,CAAA,UAAgB,CAAC,MAAM,CAAC;QAEnD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;YACP,MAAM;YACN,SAAS,MAAM,OAAO;QACxB,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF","debugId":null}}]
}